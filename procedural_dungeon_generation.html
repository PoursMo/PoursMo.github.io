---
layout: default
---
<h2>Procedural Dungeon Generation</h2>
<p>
    When I decided I wanted this game to be a Roguelite, one of the first thing I wanted was to
    implement a procedural dungeon generation algorithm. <br> After doing some research, I liked the
    approach used for the game "TinyKeep", described in a
    <a target="_blank" href="https://www.reddit.com/r/gamedev/comments/1dlwc4/procedural_dungeon_generation_algorithm_explained/">
        10 year old reddit post
    </a>.<br>
    So I started following the steps, adapting them to the vision I had in mind for my game.
</p>

<h3>Step 1 : Generating rooms</h3>

<p>
    I generate a set number of rooms in random points inside a circle.
</p>

<video autoplay muted loop playsinline>
    <source src="/content/current_project/procedural_dungeon_generation/generation.mp4" type="video/mp4">

</video>

<h3>Step 2 : Separation Steering Behaviour</h3>

<p>
    I now separate the rooms using Craig Reynolds' separation steering behavior for
    autonomous characters until there is no overlap.<br>
    I added a "space between rooms" parameter to change the overlap size of the rooms so
    that we can add space between the rooms instead of having them touching each other.
</p>

<video autoplay muted loop playsinline>
    <source src="/content/current_project/procedural_dungeon_generation/separation.mp4" type="video/mp4">
</video>

<h3>Step 3 : Delaunay Triangulation</h3>

<p>
    We now want to create a graph that connects all the rooms together without intersecting lines.
    This is done using Delaunay Triangulation. <br>
    I created 3 structs : <br>
    - An "Edge" struct made of 2 vertices <br>
    - A "Triangle" struct made of 3 vertices and 3 edges <br>
    - A "Circle" struct simply made of a center (Vector3) and a radius value. This struct is used to store the circumcircle of the triangles when doing the triangulation <br>
    The triangulation is done by adding points (in our case rooms) one by one to the triangulation,
    checking if it is in the circumcircle of any triangle in the triangulation. If it is we remove those triangles,
    then create new ones with the added point.
</p>

<video autoplay muted loop playsinline>
    <source src="/content/current_project/procedural_dungeon_generation/triangulation.mp4" type="video/mp4">
</video>

<h3>Step 4 : Spanning Tree</h3>

<p>
    Now all the rooms are connected to their neighbors, which makes too many paths and loops.
    To minimize the loops, I created a minimal spanning tree out of the graph obtained with the triangulation.<br>
    A spanning tree is a graph that will include all of the rooms so that they're all reachable.<br>
    I created a "Graph" struct to store vertices and edges.<br>
    Using Prim's algorithm, I build this tree one vertex at a time,
    from the first vertex (room), at each step adding the cheapest possible connection from the tree to another vertex.
</p>

<video autoplay muted loop playsinline>
    <source src="/content/current_project/procedural_dungeon_generation/spanning_tree.mp4" type="video/mp4">
</video>

<h3>Step 5 : Adding Loops</h3>

<video autoplay muted loop playsinline>
    <source src="/content/current_project/procedural_dungeon_generation/adding_loops.mp4" type="video/mp4">
</video>

<h3>Result and full process</h3>

<img src="/content/current_project/procedural_dungeon_generation/final.jpg">
<video autoplay muted loop playsinline>
    <source src="/content/current_project/procedural_dungeon_generation/full_video.mp4" type="video/mp4">
</video>
